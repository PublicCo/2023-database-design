(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12527ea7"],{"13d5":function(e,t,a){"use strict";var _=a("23e7"),n=a("d58f").left,r=a("a640"),i=a("ae40"),o=r("reduce"),s=i("reduce",{1:0});_({target:"Array",proto:!0,forced:!o||!s},{reduce:function(e){return n(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},3521:function(e,t,a){"use strict";var _=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"standard-table"},[a("div",{staticClass:"alert"},[e.selectedRows?a("a-alert",{attrs:{type:"info","show-icon":!0}},[a("div",{staticClass:"message",attrs:{slot:"message"},slot:"message"},[e._v(" 已选择 "),a("a",[e._v(e._s(e.selectedRows.length))]),e._v(" 项 "),a("a",{staticClass:"clear",on:{click:e.onClear}},[e._v("清空")]),e._l(e.needTotalList,(function(t,_){return[t.needTotal?a("div",{key:_}):e._e()]}))],2)]):e._e()],1),a("a-table",{attrs:{bordered:e.bordered,loading:e.loading,columns:e.columns,dataSource:e.dataSource,rowKey:e.rowKey,pagination:e.pagination,expandedRowKeys:e.expandedRowKeys,expandedRowRender:e.expandedRowRender,rowSelection:e.selectedRows?{selectedRowKeys:e.selectedRowKeys,onSelect:e.onSelect,onSelectAll:e.onSelectAll}:void 0},on:{change:e.onChange},scopedSlots:e._u([e._l(Object.keys(e.$scopedSlots).filter((function(e){return"expandedRowRender"!==e})),(function(t){return{key:t,fn:function(a,_,n){return[e._t(t,null,null,{text:a,record:_,index:n})]}}})),{key:e.$scopedSlots.expandedRowRender?"expandedRowRender":"",fn:function(t,a,_,n){return[e._t(e.$scopedSlots.expandedRowRender?"expandedRowRender":"",null,null,{record:t,index:a,indent:_,expanded:n})]}}],null,!0)},[e._l(Object.keys(e.$slots),(function(t){return a("template",{slot:t},[e._t(t)],2)}))],2)],1)},n=[],r=a("3ce2"),i=r["a"],o=(a("fe5f"),a("0c7c")),s=Object(o["a"])(i,_,n,!1,null,"4284fac8",null);t["a"]=s.exports},"3ce2":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("99af"),core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("4de4"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("4160"),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("d81d"),core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_array_map__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("13d5"),core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_reduce__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_object_values__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("07ac"),core_js_modules_es_object_values__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_object_values__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_6__),D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("5530"),D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("2909");__webpack_exports__["a"]={name:"StandardTable",props:{bordered:Boolean,loading:[Boolean,Object],columns:Array,dataSource:Array,rowKey:{type:[String,Function],default:"key"},pagination:{type:[Object,Boolean],default:!0},selectedRows:Array,expandedRowKeys:Array,expandedRowRender:Function},data:function(){return{needTotalList:[]}},methods:{equals:function(e,t){if(e===t)return!0;var a=this.rowKey;return a&&"string"===typeof a?e[a]===t[a]:!(!a||"function"!==typeof a)&&a(e)===a(t)},contains:function(e,t){if(!e||0===e.length)return!1;for(var a=this.equals,_=0;_<e.length;_++)if(a(e[_],t))return!0;return!1},onSelectAll:function(e,t){var a=this,_=this.getKey,n=this.contains,r=this.dataSource.filter((function(e){return!n(t,e,a.rowKey)})),i=this.selectedRows.filter((function(e){return!n(r,e,a.rowKey)})),o={};i.forEach((function(e){return o[_(e)]=e})),t.forEach((function(e){return o[_(e)]=e}));var s=Object.values(o);this.$emit("update:selectedRows",s),this.$emit("selectedRowChange",s.map((function(e){return _(e)})),s)},getKey:function(e){var t=this.rowKey;if(t&&e)return"string"===typeof t?e[t]:t(e)},onSelect:function(e,t){var a=this.equals,_=this.selectedRows,n=this.getKey,r=t?[].concat(Object(D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_8__["a"])(_),[e]):_.filter((function(t){return!a(t,e)}));this.$emit("update:selectedRows",r),this.$emit("selectedRowChange",r.map((function(e){return n(e)})),r)},initTotalList:function(e){return e.filter((function(e){return e.needTotal})).map((function(e){return Object(D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_7__["a"])(Object(D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_7__["a"])({},e),{},{total:0})}))},onClear:function(){this.$emit("update:selectedRows",[]),this.$emit("selectedRowChange",[],[]),this.$emit("clear")},onChange:function(e,t,a,_){var n=_.currentDataSource;this.$emit("change",e,t,a,{currentDataSource:n})}},created:function(){this.needTotalList=this.initTotalList(this.columns)},watch:{selectedRows:function selectedRows(_selectedRows2){this.needTotalList=this.needTotalList.map((function(item){return Object(D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_7__["a"])(Object(D_program_database_vue_antd_admin_zhongzhuan_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_7__["a"])({},item),{},{total:_selectedRows2.reduce((function(sum,val){var v;try{v=val[item.dataIndex]?val[item.dataIndex]:eval("val.".concat(item.dataIndex))}catch(_){v=val[item.dataIndex]}return v=isNaN(parseFloat(v))?0:parseFloat(v),sum+v}),0)})}))}},computed:{selectedRowKeys:function(){var e=this;return this.selectedRows.map((function(t){return e.getKey(t)}))}}}},"60d9":function(e,t,a){},a487:function(e,t,a){"use strict";a.r(t);var _=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{"body-style":{padding:"24px 32px"},bordered:!1,title:"疫苗申请与入库"}},[a("standard-table",{attrs:{columns:e.columns,dataSource:e.apply_record},scopedSlots:e._u([{key:"action",fn:function(t){var _=t.record;return a("div",{},[a("a",{class:{"disabled-link":!e.isActionClickable(_.key)},staticStyle:{"margin-right":"8px"},on:{click:function(t){return e.handleVaccineEntryClick(_.key)}}},[a("a-icon",{attrs:{type:"edit"}}),e._v("疫苗入库 ")],1)])}}])}),a("a-button",{attrs:{type:"primary"},on:{click:e.handleVaccineApplyClick}},[e._v("疫苗申请")]),e.form_visible?a("div",[a("p",{staticStyle:{"font-size":"large"}},[e._v("疫苗入库详情（申请时间："+e._s(e.form_time)+"）")]),a("a-form",[a("a-form-item",{attrs:{label:"疫苗ID",labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:"请输入",type:"string"},model:{value:e.vaccine_id,callback:function(t){e.vaccine_id=t},expression:"vaccine_id"}})],1),a("a-form-item",{attrs:{label:"是否合格",labelCol:{span:7},wrapperCol:{span:10}}},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.is_safe,expression:"is_safe"}],attrs:{"aria-placeholder":"请选择"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.is_safe=t.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"1"}},[e._v("是")]),a("option",{attrs:{value:"0"}},[e._v("否")])])]),a("a-form-item",{attrs:{label:"种类ID",labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:"请输入"},model:{value:e.vaccine_type_id,callback:function(t){e.vaccine_type_id=t},expression:"vaccine_type_id"}})],1),a("a-form-item",{attrs:{label:"生产日期(yyyy-mm-dd)",labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:"请输入"},model:{value:e.production_date,callback:function(t){e.production_date=t},expression:"production_date"}})],1),a("a-form-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{span:10,offset:7}}},[a("a-button",{attrs:{type:"primary"},on:{click:e.postAdd}},[e._v("提交")])],1)],1)],1):e._e(),e.apply_visible?a("div",[a("br"),a("p",{staticStyle:{"font-size":"large","text-align":"center"}},[e._v("疫苗申请（医疗点ID："+e._s(e.hos_id)+"）")]),a("a-form",[a("a-form-item",{attrs:{label:"医疗点ID",labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{disabled:"",placeholder:"请输入"},model:{value:e.hos_id,callback:function(t){e.hos_id=t},expression:"hos_id"}})],1),a("a-form-item",{attrs:{label:"申请数量",labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:"请输入"},model:{value:e.number,callback:function(t){e.number=t},expression:"number"}})],1),a("a-form-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{span:10,offset:7}}},[a("a-button",{attrs:{type:"primary"},on:{click:e.postApply}},[e._v("提交")])],1)],1)],1):e._e()],1)},n=[],r=(a("d3b7"),a("ac1f"),a("25f0"),a("1276"),a("cebe")),i=a.n(r),o=a("3521"),s=a("7424"),c=a("be65"),l=a.n(c),d=a("b775"),u=[{title:"申请时间",dataIndex:"time"},{title:"申请数量",dataIndex:"number"},{title:"已入库数量",dataIndex:"added"},{title:"未入库数量",dataIndex:"remain"},{title:"批准状态",dataIndex:"status"},{title:"操作",scopedSlots:{customRender:"action"}}],p={name:"QueryList",components:{StandardTable:o["a"]},mounted:function(){this.fetchApply()},created:function(){this.getAuthorization()},data:function(){return{hos_id:"1",vaccine_id:"",is_safe:null,vaccine_type_id:"",production_date:"",number:null,added:0,remain:0,apply_record:[],columns:u,form_visible:!1,form_time:"",current_key:"",apply_visible:!1,Authorization:"123"}},methods:{getAuthorization:function(){this.Authorization=l.a.get(d["xsrfHeaderName"]).Authorization.split(" ")[1]},fetchHospitalID:function(){var e=this;i.a.get(s["ADDRESS"]+"/MedicalStaff/GetStaffMedicalPoint",{headers:{Authorization:this.Authorization}}).then((function(t){e.hos_id=t.data.StaffList[0].hos_id})).catch((function(e){}))},fetchApply:function(){var e=this;i.a.get(s["ADDRESS"]+"/MedicalStaff/GetStaffMedicalPoint",{headers:{Authorization:this.Authorization}}).then((function(t){e.hos_id=t.data.StaffList[0].hos_id})).catch((function(e){})),i.a.get(s["ADDRESS"]+"/Vaccine/GetApplyHistory",{params:{hos_id:this.hos_id},headers:{Authorization:this.Authorization}}).then((function(t){if(t)for(var a=0;a<t.data.length;a++){var _={};_.key=a,_.time=t.data[a].appoint_time,_.number=t.data[a].appoint_num,_.added=0,_.remain=_.number-_.added,_.status=t.data[a].appoint_state,e.apply_record.push(_)}}))},postApply:function(){var e=this;null!=this.number?(this.number=this.number.toString(),i.a.post(s["ADDRESS"]+"/Vaccine/ApplyforVaccine",{},{params:{hos_id:this.hos_id,number:this.number},headers:{Authorization:this.Authorization}}).then((function(t){t?(e.$message.success("申请成功"),e.apply_visible=!1,e.number=null):e.$message.info("申请未成功")}))):this.$message.info("请输入疫苗申请数量")},postAdd:function(){var e=this,t=!0;null!==this.vaccine_id&&null!==this.is_safe||(t=!1),null!==this.vaccine_type_id&&null!==this.production_date||(t=!1),!0===t?i.a.post(s["ADDRESS"]+"/Vaccine/InsertHosVaccine",{},{data:{medical_point_id:this.hos_id,vaccine_id:this.vaccine_id,is_safe:this.is_safe,vaccine_type_id:this.vaccine_type_id,production_date:this.production_date},headers:{Authorization:this.Authorization}}).then((function(t){t?(e.$message.success("疫苗入库成功"),e.apply_record[e.current_key].added++,e.apply_record[e.current_key].remain--,e.form_visible=!1,0===e.apply_record[e.current_key].remain&&(e.apply_record[e.current_key].status="疫苗收到"),e.vaccine_id=null,e.is_safe=null,e.type=null,e.vaccine_type_id=null,e.production_date=null,e.shelf_life=null,e.manufacture=null):e.$message.info("疫苗入库失败")})):this.$message.info("请完成表单所有项的填写")},handleVaccineApplyClick:function(){!0===this.form_visible?this.$message.info("请先完成疫苗入库"):this.apply_visible=!this.apply_visible},handleVaccineEntryClick:function(e){if(this.current_key=e,!0===this.apply_visible)this.$message.info("请先完成疫苗申请");else{this.form_visible=!this.form_visible;for(var t=0;t<this.apply_record.length;t++)this.apply_record[t].key===e&&(this.form_time=this.apply_record[t].time)}},isActionClickable:function(e){return 0!==this.apply_record[e].remain&&"未处理"!==this.apply_record[e].status}}},f=p,m=(a("b55f"),a("0c7c")),h=Object(m["a"])(f,_,n,!1,null,"cf3fa846",null);t["default"]=h.exports},b55f:function(e,t,a){"use strict";var _=a("cf2c"),n=a.n(_);n.a},cf2c:function(e,t,a){},d58f:function(e,t,a){var _=a("1c0b"),n=a("7b0b"),r=a("44ad"),i=a("50c4"),o=function(e){return function(t,a,o,s){_(a);var c=n(t),l=r(c),d=i(c.length),u=e?d-1:0,p=e?-1:1;if(o<2)while(1){if(u in l){s=l[u],u+=p;break}if(u+=p,e?u<0:d<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:d>u;u+=p)u in l&&(s=a(s,l[u],u,c));return s}};e.exports={left:o(!1),right:o(!0)}},fe5f:function(e,t,a){"use strict";var _=a("60d9"),n=a.n(_);n.a}}]);